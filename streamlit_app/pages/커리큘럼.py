import streamlit as st
import pandas as pd

st.title("📚 학습 난이도 & 커리큘럼 병목 분석")

# -----------------------------
# 가짜 데이터 생성
# -----------------------------
weeks = ["Week 1", "Week 2", "Week 3", "Week 4", "Week 5", "Week 6"]
questions = [18, 24, 67, 32, 51, 22]
attendance = [88, 86, 84, 83, 80, 82]

df_questions = pd.DataFrame(
    {"주차": weeks, "질문 수": questions}
).set_index("주차")

df_attendance = pd.DataFrame(
    {"주차": weeks, "출석률": attendance}
).set_index("주차")

# “모듈” 대신 실제로 느껴지는 학습 구간 단위(주차+주제)
df_sections = pd.DataFrame(
    {
        "학습 구간": ["Week 3 - Git 협업", "Week 5 - 환경 세팅"],
        "Git/협업 관련": [0.72, 0.18],
        "환경설정/빌드 관련": [0.10, 0.63],
        "기타": [0.18, 0.19],
    }
).set_index("학습 구간")

# -----------------------------
# 탭 구성
# -----------------------------
tab_summary, tab_ai, tab_detail = st.tabs(["요약", "AI 심층 분석", "지표 상세 보기"])

# -----------------------------
# 탭 1: 요약
# -----------------------------
with tab_summary:
    st.subheader("요약 지표")

    col1, col2 = st.columns(2)
    col3, col4 = st.columns(2)
    with col1:
        st.metric("이번 주 챗봇 질문 수", "214건", "▲ 58건")
    with col2:
        st.metric("질문이 몰린 구간", "Week 3 - Git 협업")
    with col3:
        st.metric("병목 의심 학습 구간 수", "2개")
    with col4:
        st.metric("병목 이후 출석률 변화", "-7%p")

    st.markdown(
        """
- 질문과 에러가 특히 많이 쌓이는 **학습 구간**은  
  **Week 3 - Git 협업**, **Week 5 - 환경 세팅**입니다.  
- 이 두 구간 이후 일부 반의 출석률이 눈에 띄게 떨어지며,  
  **학습 피로와 난이도 부담이 누적되는 패턴**이 관찰됩니다.  
- 개념 자체보다는, **협업 도구 사용·환경 세팅에서 막히는 시간**이 길어지는 것이 병목의 핵심 원인으로 보입니다.
"""
    )

    st.markdown("### 주차별 질문/출석 흐름")
    st.bar_chart(df_questions)
    st.line_chart(df_attendance)

# -----------------------------
# 탭 2: AI 심층 분석
# -----------------------------
with tab_ai:
    st.subheader("AI 분석 요약")

    st.markdown(
        """
- **Week 3 - Git 협업 구간**
  - 전체 질문의 **31%**가 이 구간에서 발생합니다.
  - Git 관련 에러/충돌 해결 질문이 대부분입니다.
  - Week 3 이후 평균 출석률이 86% → **84%**로 내려갑니다.

- **Week 5 - 환경 세팅 구간**
  - 환경설정/빌드 관련 질문 비중이 **63%**로 가장 높습니다.
  - 반별 회의 요약에서 “세팅 문제로 시간이 지연됐다”는 표현이 자주 등장합니다.
  - Week 5 이후 평균 출석률이 83% → **80%**로 추가 하락합니다.

- **난이도·학습 경험 관점 해석**
  - 두 구간 모두, 한 번 막히면 **시간과 체력이 크게 소모되는 실습 구간**입니다.
  - 개념 이해보다는 “에러 처리·문제 해결 경험”이 부족한 상태에서 바로 프로젝트에 투입되며,
    **성취감보다 실패 경험이 더 크게 남는 흐름**이 나타납니다.
"""
    )

    with st.expander("분석 근거 자세히 보기"):
        st.markdown(
            """
- Week 3 - Git 협업
  - 챗봇 질문 수: 24건 → **67건**  
  - Git/협업 관련 비중: **72%**  
  - 이후 주차 평균 출석률: 86% → **84%**

- Week 5 - 환경 세팅
  - 환경설정/빌드 관련 비중: **63%**  
  - 회의 요약 중 세팅 관련 언급: 12% → **38%**  
  - 이후 주차 평균 출석률: 83% → **80%**
"""
        )

    st.subheader("운영 액션 제안")

    st.markdown(
        """
- **Git 협업 구간(Week 3) 구조 조정**
  - Git 협업을 한 번에 다루기보다, **두 개의 학습 구간으로 나누는 것**을 추천합니다.
    - 1단계: 브랜치 전략, pull/push, 간단한 PR까지  
    - 2단계: 의도적으로 conflict를 만든 뒤, 해결하는 실습
  - 각 반에서 실제로 자주 발생한 에러를 모아 **“Git 문제 해결 가이드”**로 정리하면,
    하루 종일 같은 문제에 붙잡히는 시간을 줄일 수 있습니다.

- **환경 세팅 구간(Week 5) 지원 강화**
  - 모든 반에 공통으로 사용할 수 있는 **기본 템플릿 레포지토리**와,
    세팅이 완료된 예제 프로젝트를 함께 제공하는 것이 좋습니다.
  - 환경 세팅에서 막힌 반/조만 따로 모아 진행하는 **환경 점검 클리닉 시간**을 주 1회 운영하면,
    정규 수업·회의 시간을 본질적인 논의에 더 쓸 수 있습니다.

- **학습자 커뮤니케이션 방향**
  - “지금 진행 중인 구간은 원래 누구에게나 난이도가 높게 느껴지는 단계”라는 사실을 솔직하게 공유합니다.
  - 뒤처지는 느낌을 줄이기 위해,
    - “막힌 부분을 말해도 괜찮다”  
    - “이 구간에서 힘든 건 혼자가 아니다”  
    는 메시지를 여러 번 반복해 주는 것이 중요합니다.
"""
    )

# -----------------------------
# 탭 3: 지표 상세
# -----------------------------
with tab_detail:
    st.subheader("주차별 질문 수")
    st.bar_chart(df_questions)

    st.subheader("주차별 평균 출석률")
    st.line_chart(df_attendance)

    st.subheader("병목이 의심되는 학습 구간별 질문 카테고리 비중")
    st.bar_chart(df_sections)
